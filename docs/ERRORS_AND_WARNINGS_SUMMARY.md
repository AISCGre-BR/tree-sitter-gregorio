# Summary of Errors and Warnings (Gregorio compiler)

This document summarizes the situations defined in `GREGORIO_COMPILER_ERRORS_AND_WARNINGS.md` that may result in a compilation **error** (blocking) or a **warning** (non-blocking but may produce defective rendering). It also includes a few additional musical warnings requested explicitly (quilisma / virga cases) and a lighter-than-warning note about missing connectors in quilismatic sequences.

> Location references point to the original implementation files (see `docs/GREGORIO_COMPILER_ERRORS_AND_WARNINGS.md`).

---

## Errors (VERBOSITY_ERROR)

Errors prevent successful compilation. Each item below includes the reported message, the location (function/file), and a concise description.

- **`unable to determine a valid score from file`**
  - Location: `gabc_read_score` (`gabc-score-determination.c:642`)
  - Description: The compiler could not determine a valid musical score from the file; usually due to integrity errors in the score.

- **`line break is not supported on the first syllable`**
  - Location: `check_score_integrity` (`gabc-score-determination.c:165-167`)
  - Description: A line break (`z` / `Z`) was found on the first syllable, which is not supported.

- **`clef change is not supported on the first syllable`**
  - Location: `check_score_integrity` (`gabc-score-determination.c:171-173`)
  - Description: A clef change was found on the first syllable, which is invalid.

- **`score initial may not be in an elision`**
  - Location: `check_score_integrity` (`gabc-score-determination.c:185-187`)
  - Description: The beginning of the score cannot be inside an elision.

- **`syntax error` (generated by Bison parser)**
  - Location: Bison parser (`gabc-score-determination.y`)
  - Description: Generic syntax error when the parser encounters an unexpected token or invalid construction.

- **`style already started: %s`**
  - Location: `add_style` (`gabc-score-determination.y:368-370`)
  - Description: Style tag opened while already open (`%s` = style name).

- **`style not started: %s`**
  - Location: `end_style` (`gabc-score-determination.y:385-387`)
  - Description: Style tag closed when it was not open.

- **`forced center may not be within an elision`**
  - Location: `close_syllable` (`gabc-score-determination.y:548-550`)
  - Description: A forced center (`{}`) cannot appear inside an elision.

- **`encountering translation centering end but cannot find translation centering beginning...`**
  - Location: `set_translation_center_beginning` (`gabc-score-determination.y:266-268, 279-281`)
  - Description: A translation centering end `[/]` was found without a matching beginning.

- **Data structure & API errors** (examples)
  - `too many texverbs` (`register_texverb`, `struct.c:120-121`) — texverb count exceeded.
  - `trying to add a secondary clef to something that is not a note` (`gregorio_add_secondary_clef_to_note`, `struct.c:279-281`).
  - `secondary clef already exists` (`struct.c:286-287`).
  - `trying to add a special sign to something that is not a note` (`struct.c:405-406`).
  - `trying to change the shape of something that is not a note` (`change_shape`, `struct.c:467-468, 500-501`).
  - `trying to add cavum to something that is not a note` (`change_shape`, `struct.c:500-501`).
  - `trying to make a liquescence on something that is not a note` (`add_liquescentia`, `struct.c:511-512`).
  - `isolated horizontal episema after something that is not a note` (`add_h_episema`, `struct.c:589-593`).
  - `found more horizontal episema than notes in the glyph` (`add_h_episema`, `struct.c:599-601`).
  - `trying to add a horizontal episema on something that is not a note` (`add_h_episema`, `struct.c:613-615`).
  - `trying to add a forced horizontal episema on a note that already has an episema` (`add_h_episema`, `struct.c:620-622`).
  - `trying to add a sign to something that is not a note` (`gregorio_add_sign`, `struct.c:651-652`).
  - `invalid number of staff lines` (`gregorio_set_score_staff_lines`, `struct.c:1222-1223`).
  - `too many horizontal episema adjustments` (`gregorio_add_hepisema_adjustment`, `struct.c:1571-1572`).

- **`pipe '|' in note group without `nabc-lines` header`**
  - Location: parser/validation (when processing `note_group` tokens)
  - Description: A pipe character (`|`) used as separator between GABC and NABC snippets inside a `note_group` was found, but the file header does not contain the `nabc-lines: ...;` declaration. The `nabc-lines` header is required when mixing GABC and NABC snippet separators; its absence indicates a malformed file or missing configuration and prevents correct parsing/compilation.
  - Example symptom: presence of `|` inside `( ... )` groups while the header section lacks a `nabc-lines:` line.
  - Severity: Error (prevents successful compilation).

- **Character encoding errors**
  - `malformed UTF-8 sequence1` (`gregorio_mbstowcs`, `unicode.c:77-78`).
  - `malformed UTF-8 sequence2` (`gregorio_mbstowcs`, `unicode.c:90-91`).

- **Memory and system errors**
  - `error in memory allocation` (`gregorio_malloc`, `support.c:58`).
  - `buffer too large` (`gregorio_grow_buffer`, `support.c:94`).
  - `invalid buffer size` (`gregorio_getline`, `support.c:178`).
  - `Error reading from the file` (`gregorio_getline`, `support.c:197`).

- **Note processing errors** (examples)
  - `unexpected shape: %s` (`add_note_to_a_glyph`, `gabc-glyphs-determination.c:442`).
  - Several `Unexpected texverb` messages at different phases (`next_non_texverb_note`, `close_fusion_glyph`, etc.).
  - `Unexpected single note during fusion` and `Unexpected end of notes during fusion` (`close_fusion_glyph`).

- **Character set errors**
  - `character set too large` (`character_set_grow`, `vowel/vowel.c:133`).

---

## Warnings (VERBOSITY_WARNING)

Warnings do not stop compilation but may lead to incorrect or suboptimal rendering. Items below list message, location and description.

- **Header warnings**
  - `no name specified, put 'name:...;' at the beginning of the file, can be dangerous with some output formats` (`gabc_check_infos_integrity`, `gabc-score-determination.c:203-205`)
    - Description: Missing `name:` header; may cause issues in some output formats.
  - `several %s definitions found, only the last will be taken into consideration` (`check_multiple`, `gabc-score-determination.y:146-148`)
    - Description: Multiple definitions of same header; only last is used.

- **Style and formatting warnings**
  - `syllable already has protrusion; pr tag ignored` (`add_protrusion`, `gabc-score-determination.y:446-447`)
  - `closing open syllable center before protrusion` (`add_protrusion`, `gabc-score-determination.y:451-452`)
  - `too many annotations` (`gregorio_set_annotation`, `struct.c:1212-1213`)

- **File system warnings**
  - `unable to open %s: %s` (`gregorio_vowel_tables_load`, `vowel/vowel.c:250-251`)
  - `unable to read vowel files for %s` (`gregorio_set_centering_language`, `characters.c:112-113`)
  - `unable to read %s: %s` (`read_patterns`, `support.c:261`)
  - `unable to find %s using kpathsea` (`gregorio_kpse_find`, `support.c:222, 244-246`)

- **Note processing warnings**
  - `Encountered the need to switch DET_END_OF_CURRENT to DET_END_OF_BOTH because of overly large ambitus` (`add_note_to_a_glyph`, `gabc-glyphs-determination.c:480-483`)

---

## Additional musical warnings requested (added)

These rules are not explicit errors in the original summary but are common musical/layout constraints that can cause rendering issues. They are added here as warnings (non-blocking) to help composers and tools detect problematic constructions.

1) **Quilisma followed by an equal-or-lower pitch note**
   - Condition: A quilisma note is immediately followed by a note whose pitch is equal to or lower than the quilisma's pitch.
   - Why it's a problem: Quilisma is a special ornament requiring careful vertical/horizontal placement; following it by an equal/lower note may break expected accent/placement conventions and cause incorrect engraving.
   - Examples: `(gwg)`, `(gwf)`, `(gwe)` — here `w` indicates the quilisma note and the following note has equal or lower pitch.
   - Severity: Warning.

2) **Quilisma-pes preceded by an equal-or-higher pitch note**
   - Condition: A quilisma with pes (quilisma-pes) appears and the note immediately before it has equal or higher pitch than the quilisma's note.
   - Why it's a problem: The pes/quilisma-pes interaction assumes an upward approach for correct placement; a previous note of equal or higher pitch can cause collisions or wrong horizontal spacing.
   - Examples: `Ad(h) te(gwh)`, `Ad(i) te(gwh)`, `Ad(g) te(gwh)` — the quilisma-pes `gwh` follows a preceding note of equal/higher pitch.
   - Severity: Warning.

3) **Virga strata followed by equal-or-higher pitch**
   - Condition: A `virga strata` (a virga with strata modifier) is followed by a note with equal or higher pitch.
   - Why it's a problem: Virga strata imply a vertical/positional relationship expecting certain contour; a following equal/higher pitch note can force awkward placements.
   - Examples: `Ad(ffo) te(f)`, `Ad(ffo) te(g)`, `Ad(ffo) te(h)` — `ffo` denotes a strata on the virga, followed by notes as above.
   - Severity: Warning.

4) **Lighter-than-warning: missing connector `!` in quilismatic sequences (3+ notes)**
   - Condition: A neume of 3 or more notes that includes a quilisma lacks the connector `!` between the quilismatic note and the immediately preceding note.
   - Why it's important: In many neumatic constructions the `!` connector indicates a specific horizontal joining behavior. Missing it can slightly alter glyph fusion or spacing but usually does not break compilation.
   - Examples:
     - Problematic: `(fgwh)` — missing connector between `f` and `gwh`.
     - Correct: `(f!gwh)` — connector present.
     - Problematic: `(efgwh)` — missing connector between `f` and `gwh` (assuming quilisma at `g`).
     - Correct: `(ef!gwh)`.
   - Severity: Informational (less severe than a warning). Recommend emitting a low-severity hint to suggest adding `!` where appropriate.

---

## Recommended actions for tools and users

- Treat the items in the **Errors** section as blocking: fix source file or structure before attempting to compile.
- For **Warnings**, present them clearly to the user with file/line context and suggested fixes when possible.
- For the additional musical warnings above, consider adding automatic lint rules in tooling (or optional compiler checks) to detect these cases and present helpful guidance (e.g., suggest reversing note order, add connector `!`, or inspect ornament placement).

---

File generated from `docs/GREGORIO_COMPILER_ERRORS_AND_WARNINGS.md` and user-provided extra rules.
