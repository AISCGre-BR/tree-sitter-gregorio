# Gregorio Compiler Errors and Warnings

This document specifies the compilation error hypotheses and possible warnings generated by the Gregorio compiler, based on analysis of the compiler source code.

## Verbosity Levels

The Gregorio compiler uses different verbosity levels to classify messages:

- `VERBOSITY_INFO`: Informative messages
- `VERBOSITY_WARNING`: Warnings - do not prevent compilation
- `VERBOSITY_ERROR`: Errors - prevent successful compilation
- `VERBOSITY_ASSERTION`: Assertions - programming errors (should not occur in normal use)

## Compilation Errors (VERBOSITY_ERROR)

### Structure and Integrity Errors

#### `unable to determine a valid score from file`
**Location**: `gabc_read_score` (gabc-score-determination.c:642)
**Description**: The compiler could not determine a valid score from the file. This usually occurs when there are integrity errors in the score.

#### `line break is not supported on the first syllable`
**Location**: `check_score_integrity` (gabc-score-determination.c:165-167)
**Description**: A line break was found on the first syllable, which is not supported.

#### `clef change is not supported on the first syllable`
**Location**: `check_score_integrity` (gabc-score-determination.c:171-173)
**Description**: A clef change was found on the first syllable, which is not supported.

#### `score initial may not be in an elision`
**Location**: `check_score_integrity` (gabc-score-determination.c:185-187)
**Description**: The beginning of the score cannot be within an elision.

### Syntax and Parsing Errors

#### `syntax error` (generated by Bison parser)
**Location**: Bison parser (gabc-score-determination.y)
**Description**: Generic syntax error generated by the parser when it encounters an unexpected token or invalid syntactic construction.

### Style and Formatting Errors

#### `style already started: %s`
**Location**: `add_style` (gabc-score-determination.y:368-370)
**Description**: A style tag was opened when it was already open. The `%s` will be replaced by the style name (italic, bold, etc.).

#### `style not started: %s`
**Location**: `end_style` (gabc-score-determination.y:385-387)
**Description**: A style tag was closed when it was not open. The `%s` will be replaced by the style name.

#### `forced center may not be within an elision`
**Location**: `close_syllable` (gabc-score-determination.y:548-550)
**Description**: A forced center (using braces `{}`) cannot be within an elision.

#### `encountering translation centering end but cannot find translation centering beginning...`
**Location**: `set_translation_center_beginning` (gabc-score-determination.y:266-268, 279-281)
**Description**: A translation centering end (`[/]`) was found without a corresponding beginning.

### Data Structure Errors

#### `too many texverbs`
**Location**: `register_texverb` (struct.c:120-121)
**Description**: Exceeded the maximum number of texverbs allowed.

#### `trying to add a secondary clef to something that is not a note`
**Location**: `gregorio_add_secondary_clef_to_note` (struct.c:279-281)
**Description**: Attempt to add a secondary clef to something that is not a note.

#### `secondary clef already exists`
**Location**: `gregorio_add_secondary_clef_to_note` (struct.c:286-287)
**Description**: Attempt to add a secondary clef when one already exists.

#### `trying to add a special sign to something that is not a note`
**Location**: `gregorio_add_special_sign` (struct.c:405-406)
**Description**: Attempt to add a special sign to something that is not a note.

#### `trying to change the shape of something that is not a note`
**Location**: `change_shape` (struct.c:467-468, 500-501)
**Description**: Attempt to change the shape of something that is not a note.

#### `trying to add cavum to something that is not a note`
**Location**: `change_shape` (struct.c:500-501)
**Description**: Attempt to add cavum to something that is not a note.

#### `trying to make a liquescence on something that is not a note`
**Location**: `add_liquescentia` (struct.c:511-512)
**Description**: Attempt to make a liquescence on something that is not a note.

#### `isolated horizontal episema after something that is not a note`
**Location**: `add_h_episema` (struct.c:589-593)
**Description**: An isolated horizontal episema was found after something that is not a note.

#### `found more horizontal episema than notes in the glyph`
**Location**: `add_h_episema` (struct.c:599-601)
**Description**: More horizontal episemata were found than notes in the glyph.

#### `trying to add a horizontal episema on something that is not a note`
**Location**: `add_h_episema` (struct.c:613-615)
**Description**: Attempt to add a horizontal episema to something that is not a note.

#### `trying to add a forced horizontal episema on a note that already has an episema`
**Location**: `add_h_episema` (struct.c:620-622)
**Description**: Attempt to add a forced horizontal episema to a note that already has an episema.

#### `trying to add a sign to something that is not a note`
**Location**: `gregorio_add_sign` (struct.c:651-652)
**Description**: Attempt to add a sign to something that is not a note.

#### `invalid number of staff lines`
**Location**: `gregorio_set_score_staff_lines` (struct.c:1222-1223)
**Description**: Invalid number of staff lines specified.

#### `too many horizontal episema adjustments`
**Location**: `gregorio_add_hepisema_adjustment` (struct.c:1571-1572)
**Description**: Exceeded the maximum number of horizontal episema adjustments allowed.

### Character Encoding Errors

#### `malformed UTF-8 sequence1`
**Location**: `gregorio_mbstowcs` (unicode.c:77-78)
**Description**: Malformed UTF-8 sequence found during multibyte string to wide character conversion.

#### `malformed UTF-8 sequence2`
**Location**: `gregorio_mbstowcs` (unicode.c:90-91)
**Description**: Malformed UTF-8 sequence found during multibyte string to wide character conversion.

### Memory and System Errors

#### `error in memory allocation`
**Location**: `gregorio_malloc` (support.c:58)
**Description**: Error allocating memory.

#### `buffer too large`
**Location**: `gregorio_grow_buffer` (support.c:94)
**Description**: The buffer exceeded the maximum allowed size.

#### `invalid buffer size`
**Location**: `gregorio_getline` (support.c:178)
**Description**: Invalid buffer size specified.

#### `Error reading from the file`
**Location**: `gregorio_getline` (support.c:197)
**Description**: Error reading from the file.

### Note Processing Errors

#### `unexpected shape: %s`
**Location**: `add_note_to_a_glyph` (gabc-glyphs-determination.c:442)
**Description**: Unexpected note shape found during glyph processing.

#### `Unexpected texverb at start of iteration`
**Location**: `next_non_texverb_note` (gabc-glyphs-determination.c:674)
**Description**: Unexpected texverb found at the start of an iteration.

#### `Unexpected texverb at end of iteration`
**Location**: `next_non_texverb_note` (gabc-glyphs-determination.c:687)
**Description**: Unexpected texverb found at the end of an iteration.

#### `Unexpected texverb at start of fusion`
**Location**: `close_fusion_glyph` (gabc-glyphs-determination.c:721)
**Description**: Unexpected texverb found at the start of a fusion.

#### `Unexpected texverb at end of fusion`
**Location**: `close_fusion_glyph` (gabc-glyphs-determination.c:741)
**Description**: Unexpected texverb found at the end of a fusion.

#### `Unexpected single note during fusion`
**Location**: `close_fusion_glyph` (gabc-glyphs-determination.c:753)
**Description**: Unexpected single note found during a fusion.

#### `Unexpected end of notes during fusion`
**Location**: `close_fusion_glyph` (gabc-glyphs-determination.c:774)
**Description**: Unexpected end of notes found during a fusion.

### Character Set Errors

#### `character set too large`
**Location**: `character_set_grow` (vowel/vowel.c:133)
**Description**: The character set exceeded the maximum allowed size.

## Warnings (VERBOSITY_WARNING)

### Header Warnings

#### `no name specified, put 'name:...;' at the beginning of the file, can be dangerous with some output formats`
**Location**: `gabc_check_infos_integrity` (gabc-score-determination.c:203-205)
**Description**: No `name` field was specified in the header. Although not required for compilation, it can be dangerous with some output formats.

#### `several %s definitions found, only the last will be taken into consideration`
**Location**: `check_multiple` (gabc-score-determination.y:146-148)
**Description**: Multiple definitions of the same header were found. Only the last will be considered. The `%s` will be replaced by the header name.

### Style and Formatting Warnings

#### `syllable already has protrusion; pr tag ignored`
**Location**: `add_protrusion` (gabc-score-determination.y:446-447)
**Description**: The syllable already has a protrusion defined. The additional `pr` tag is ignored.

#### `closing open syllable center before protrusion`
**Location**: `add_protrusion` (gabc-score-determination.y:451-452)
**Description**: An open syllable center is being closed before a protrusion.

#### `too many annotations`
**Location**: `gregorio_set_annotation` (struct.c:1212-1213)
**Description**: Exceeded the maximum number of annotations allowed.

### File System Warnings

#### `unable to open %s: %s`
**Location**: `gregorio_vowel_tables_load` (vowel/vowel.c:250-251)
**Description**: Could not open a vowel table file. The first `%s` is the file name, the second is the system error message.

#### `unable to read vowel files for %s`
**Location**: `gregorio_set_centering_language` (characters.c:112-113)
**Description**: Could not read vowel files for the specified language. The `%s` will be replaced by the language name.

#### `unable to read %s: %s`
**Location**: `read_patterns` (support.c:261)
**Description**: Could not read a patterns file. The first `%s` is the file name, the second is the system error message.

#### `unable to find %s using kpathsea`
**Location**: `gregorio_kpse_find` (support.c:222, 244-246)
**Description**: Could not find a file using the kpathsea system. The `%s` will be replaced by the file name.

### Note Processing Warnings

#### `Encountered the need to switch DET_END_OF_CURRENT to DET_END_OF_BOTH because of overly large ambitus`
**Location**: `add_note_to_a_glyph` (gabc-glyphs-determination.c:480-483)
**Description**: The need to change the end of the current glyph to both was found due to an overly large ambitus.

## Informative Messages (VERBOSITY_INFO)

### Vowel Rules Information

#### `%s %s in %s`
**Location**: `read_rules` (characters.c:80)
**Description**: Information about vowel rules being read. The `%s` are replaced by information about the rule, type, and file.

#### `Falling back on internal Latin vowel rules`
**Location**: `read_rules` (characters.c:89)
**Description**: The compiler is using the internal Latin vowel rules as fallback.

#### `%s %s in %s`
**Location**: `read_rules` (characters.c:66)
**Description**: Information about vowel rules being processed.

### Key Information

#### Messages about initial key adjustments
**Location**: `gregorio_fix_initial_keys` (struct.c:1456, 1485)
**Description**: Information about automatic initial key adjustments being made.

## Assertions (VERBOSITY_ASSERTION)

Assertions are programming errors that should not occur in normal use. They indicate bugs in the compiler or incorrect use of internal APIs.

#### `unsupported %s %s`
**Location**: `gabc-write.c:61`
**Description**: Attempt to write an unsupported element. The `%s` are replaced by information about the element.

## Notes on Error Handling

1. **Fatal Errors**: Errors marked as `VERBOSITY_ERROR` prevent successful compilation. The compiler may continue processing to find more errors, but will not produce valid output.

2. **Warnings**: Warnings do not prevent compilation, but indicate potential problems that should be fixed.

3. **Informative Messages**: Informative messages provide feedback about processing, but do not indicate problems.

4. **Location**: Many error messages include information about the line and column where the error occurred, when available.

5. **Context**: Some messages include additional context, such as the name of the function where the error occurred, to facilitate debugging.

## References

This specification is based on analysis of the Gregorio compiler source code, available at:
- Official repository: https://github.com/gregorio-project/gregorio
- Main files analyzed:
  - `src/gabc/gabc-score-determination.c`
  - `src/gabc/gabc-score-determination.y`
  - `src/gabc/gabc-glyphs-determination.c`
  - `src/struct.c`
  - `src/unicode.c`
  - `src/support.c`
  - `src/vowel/vowel.c`
  - `src/characters.c`
  - `src/messages.h`
  - `src/messages.c`